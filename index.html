<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover"
    />
    <title>Partner-Caregiver Interpretation Task</title>
    <link rel="stylesheet" href="./styles.css?v=20" />
  </head>

  <body>
    <!-- ===== Instructions ===== -->
    <section id="screen-instructions" class="screen show" role="region" aria-labelledby="inst-title">
      <div class="inst-card">
        <header class="inst-header">
          <h1 id="inst-title">Partner-Caregiver Interpretation Assessment</h1>
          <p class="subtitle">Please read before you begin</p>
        </header>

        <div class="inst-content">
          <ol class="inst-list">
            <li><strong>Eligibility.</strong> Married partners, cohabiting for <em>≥ 2 years</em>.</li>
            <li><strong>Task.</strong> Four-line ambiguous scenarios; pick what feels closest. No right/wrong.</li>
            <li><strong>Practice.</strong> Two neutral practice items (not recorded).</li>
            <li><strong>Privacy.</strong> Data summarized; individual responses are confidential.</li>
          </ol>
          <details class="inst-details">
            <summary>Copyright &amp; Use</summary>
            <p class="smallprint">
              Designed and developed by <strong>Pouyan Alizadeh</strong> &amp; <strong>Ali Khatibi</strong>. All rights reserved.
              Written consent is required for reuse/distribution.
            </p>
          </details>
        </div>

        <footer class="inst-footer">
          <button id="btn-begin" class="primary">I’m ready to begin</button>
          <p class="footnote smallprint">By continuing, you confirm eligibility and consent.</p>
        </footer>
      </div>
    </section>

    <!-- ===== Task ===== -->
    <section id="screen-task" class="screen hidden">
      <div id="fixation" class="fixation" style="display:none">+</div>
      <div class="task-wrap">
        <div id="scenario" class="scenario">
          <div id="line1" class="line"></div>
          <div id="line2" class="line"></div>
          <div id="line3" class="line"></div>
          <div id="line4" class="line strong"></div>
        </div>

        <div id="answers" class="answers" style="display:none">
          <button id="opt1" class="answer-btn" data-index="0"></button>
          <button id="opt2" class="answer-btn" data-index="1"></button>
        </div>
      </div>

      <div id="confidence" class="confidence hidden">
        <div class="conf-wrap">
          <div class="conf-title">How confident are you?</div>
          <div class="conf-grid">
            <button class="conf" data-val="1">1</button>
            <button class="conf" data-val="2">2</button>
            <button class="conf" data-val="3">3</button>
            <button class="conf" data-val="4">4</button>
            <button class="conf" data-val="5">5</button>
          </div>
        </div>
      </div>
    </section>

    <!-- ===== Results ===== -->
    <section id="screen-results" class="screen hidden">
      <div class="card" id="reportRoot">
        <h2>Results</h2>
        <p id="metaLine" class="muted"></p>

        <div class="row">
          <div class="done-card" style="flex:1">
            <strong>Summary</strong>
            <div>N trials: <span id="m_n">0</span></div>
            <div>Benign choices: <span id="m_benign">0</span> (<span id="m_prop_benign">0</span>)</div>
            <div>Threat choices: <span id="m_threat">0</span> (<span id="m_prop_threat">0</span>)</div>
            <div>RT (ms) benign: <span id="m_rt_b_m">0</span> ± <span id="m_rt_b_sd">0</span></div>
            <div>RT (ms) threat: <span id="m_rt_t_m">0</span> ± <span id="m_rt_t_sd">0</span></div>
            <div>Confidence benign / threat: <span id="m_conf_b_m">0</span> / <span id="m_conf_t_m">0</span></div>
            <div>Pattern: <span id="m_pattern">—</span></div>
          </div>
        </div>

        <h3>APA-style note</h3>
        <pre id="apaText" class="apa"></pre>

        <h3 style="margin-top:1rem;">Visual summary</h3>
        <div class="charts">
          <div class="chart-card">
            <div class="chart-title">Interpretation proportions</div>
            <canvas id="chartChoices"></canvas>
            <div class="caption">Proportion of benign vs. threat completions.</div>
          </div>

          <div class="chart-card">
            <div class="chart-title">Reaction time (ms)</div>
            <canvas id="chartRT"></canvas>
            <div class="caption">Mean decision RT for benign and threat choices.</div>
          </div>

          <div class="chart-card">
            <div class="chart-title">Confidence (1–5)</div>
            <canvas id="chartConf"></canvas>
            <div class="caption">Mean confidence for benign vs. threat choices.</div>
          </div>

          <div class="chart-card chart-wide">
            <div class="chart-title">Trial sequence</div>
            <canvas id="chartSeq"></canvas>
            <div class="caption">Each block is a trial (blue=benign, red=threat).</div>
          </div>
        </div>

        <div class="row" style="margin-top:12px;">
          <button id="dlCsv" class="secondary">Download CSV</button>
          <button id="dlJson" class="secondary">Download JSON</button>
          <button id="copyApa" class="secondary">Copy APA text</button>
          <button id="savePng" class="secondary">Export charts (PNG)</button>
          <button id="savePdf" class="secondary">Export full PDF report</button>
          <button id="again" class="primary">Run Again</button>
        </div>
      </div>
    </section>

    <!-- Data + libs + app -->
    <script src="./scenarios.js?v=4"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <script src="./app.js?v=20"></script>
  </body>
</html>
